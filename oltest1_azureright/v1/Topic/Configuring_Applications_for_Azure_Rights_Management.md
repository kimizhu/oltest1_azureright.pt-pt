---
description: na
keywords: na
title: Configuring Applications for Azure Rights Management
search: na
ms.date: na
ms.service: rights-management
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: ea09cbc5-b98b-444e-8b60-5bc3cb199c36
---
# Configurar as aplica&#231;&#245;es para o Azure Rights Management
> [!NOTE]
> Esta informação é para os administradores de TI e consultores que implementaram Azure Rights Management. Se estiver à procura de ajuda de utilizador e informações sobre como utilizar a gestão de direitos para uma aplicação específica ou como abrir um ficheiro que está protegido por direitos, utilize a ajuda e orientações que acompanha a sua aplicação.
> 
> Por exemplo, para aplicações do Office, clique no ícone de ajuda e introduza os termos da pesquisa, como **Rights Management** ou **IRM**. Para a aplicação de partilha RMS para Windows, consulte o [Guia de utilizador de aplicação partilha Rights Management](http://technet.microsoft.com/library/dn339006.aspx).

Depois de ter implementado Azure Rights Management (RMS do Azure) para a sua organização, utilize as seguintes informações para configurar a aplicações e serviços para suportar o Azure RMS. Estes incluem aplicações do Office como o Word 2013 e Word 2010 e serviços como o Exchange Online (regras de transporte, prevenção de perda de dados, efetue não reencaminhar e encriptação de mensagens) e no SharePoint Online (bibliotecas protegidas). Para obter informações sobre como estas aplicações e serviços suportam gestão de direitos, consulte o artigo [Como as aplicações suportam gestão de direitos do Azure](../Topic/How_Applications_Support_Azure_Rights_Management.md).

> [!IMPORTANT]
> Para obter informações sobre versões suportadas e outros requisitos, consulte o artigo [Requisitos para o Azure Rights Management](../Topic/Requirements_for_Azure_Rights_Management.md).

-   [Office 365: Configuração para os clientes e serviços online](../Topic/Configuring_Applications_for_Azure_Rights_Management.md#BKMK_O365)

    -   [Exchange Online: Configuração de IRM](../Topic/Configuring_Applications_for_Azure_Rights_Management.md#BKMK_ExchangeOnline)

    -   [SharePoint Online e OneDrive para empresas: Configuração de IRM](#BKMK_SharePointOnline)

-   [2016 do Office e Office 2013: Configuração de clientes](#BKMK_Office2013Configuration)

-   [Office 2010: Configuração de clientes](../Topic/Configuring_Applications_for_Azure_Rights_Management.md#BKMK_Office2010Configuration)

-   [Aplicação de partilha Rights Management: Instalação e configuração de clientes](../Topic/Configuring_Applications_for_Azure_Rights_Management.md#BKMK_SharingApp)

    -   [Aplicação de partilha RMS para Windows: Instalação e configuração](../Topic/Configuring_Applications_for_Azure_Rights_Management.md#BKMK_SharingAppforWindows)

    -   [Aplicação de partilha RMS para plataformas móveis: Instalação](../Topic/Configuring_Applications_for_Azure_Rights_Management.md#BKMK_SharingAppMovileDevices)

-   [Outras aplicações que suportam as APIs de RMS: Instalação e configuração](../Topic/Configuring_Applications_for_Azure_Rights_Management.md#BKMK_RMSAPIs)

Para configurar servidores no local, como o Exchange Server e no SharePoint Server, consulte o artigo [Implementar o conector de gestão de direitos do Azure](../Topic/Deploying_the_Azure_Rights_Management_Connector.md).

> [!TIP]
> Para obter exemplos de alto nível e capturas de ecrã das aplicações configuradas para utilizar o Azure RMS, consulte o [Azure RMS em ação: O que os utilizadores e administradores visualizam](../Topic/What_is_Azure_Rights_Management_.md#BKMK_RMSpictures) secção a partir de [O que é o Azure Rights Management?](../Topic/What_is_Azure_Rights_Management_.md) tópico.

## <a name="BKMK_O365"></a>Office 365: Configuração para os clientes e serviços online
Como o Office 365 suporta nativamente o Azure RMS, é necessária para suportar as funcionalidades de gestão (IRM) de direitos de informação para aplicações, como o Word, Excel, PowerPoint, Outlook e o Outlook Web App nenhuma configuração de computador de cliente. Todos os utilizadores tem de fazer é iniciar sessão para as suas aplicações do Office com os respetivos [!INCLUDE[o365_1](../Token/o365_1_md.md)] credenciais e podem proteger ficheiros e mensagens de correio eletrónico e utilizar ficheiros e mensagens de correio eletrónico que foram protegidas por outros utilizadores.

No entanto, recomendamos que complementar estas aplicações com a gestão de direitos de partilha de aplicações, para que os utilizadores acedam a vantagem do Office, suplementos. Para obter mais informações, consulte o [Aplicação de partilha Rights Management: Instalação e configuração de clientes](../Topic/Configuring_Applications_for_Azure_Rights_Management.md#BKMK_SharingApp) deste tópico.

### <a name="BKMK_ExchangeOnline"></a>Exchange Online: Configuração de IRM
Para configurar o Exchange Online para suportar o Azure RMS, tem de configurar o serviço de gestão (IRM) de direitos de informação para o Exchange Online. Para fazer isto, utilizar o Windows PowerShell (sem ter de instalar um módulo separado) e execute [comandos do PowerShell para o Exchange Online](https://technet.microsoft.com/library/jj200677.aspx).

> [!NOTE]
> Não pode atualmente configurar Exchange Online para suportar o Azure RMS se estiver a utilizar uma chave de inquilino de cliente geridos (BYOK) para o Azure RMS em vez da configuração predefinida de uma chave de inquilino gerido por Microsoft. Para obter mais informações, consulte o [BYOK pricing and restrictions](../Topic/Planning_and_Implementing_Your_Azure_Rights_Management_Tenant_Key.md#BKMK_Pricing) secção a [Planear e implementar a sua chave de inquilino do Azure Rights Management](../Topic/Planning_and_Implementing_Your_Azure_Rights_Management_Tenant_Key.md) tópico.
> 
> Se tentar configurar o Exchange Online quando está a utilizar o Azure RMS BYOK, o comando para importar a chave (passo 5, no procedimento seguinte) falha com a mensagem de erro **[FailureCategory = Cmdlet FailedToGetTrustedPublishingDomainFromRmsOnlineException]**.

Os passos seguintes fornecem um conjunto comum de comandos que seria executar para ativar o Exchange Online utilizam o Azure RMS:

1.  Se esta for a primeira vez que utiliza o Windows PowerShell para o Exchange Online no seu computador, tem de configurar o Windows PowerShell para executar scripts assinados. Inicie a sessão do Windows PowerShell, utilizando o **Executar como administrador** opção e, em seguida, escreva:

    ```
    Set-ExecutionPolicy RemoteSigned
    ```

2.  Na sessão do Windows PowerShell, inicie sessão no Exchange Online, utilizando uma conta que está ativada para acesso remoto de Shell. Por predefinição, todas as contas que são criadas no Exchange Online ativadas para acesso remoto de Shell, mas isto pode ser desativado (e ativado) utilizando o   [Set-utilizador &lt; UserIdentity &gt; - RemotePowerShellEnabled](https://technet.microsoft.com/library/jj984292%28v=exchg.160%29.aspx) comando.

    Para iniciar sessão, escreva:

    ```
    $Cred = Get-Credential
    ```
    No **pedido de credenciais do Windows PowerShell** diálogo caixa, forneça o nome de utilizador do Office 365 e a palavra-passe.

3.  Ligar ao serviço do Exchange Online, executando os seguintes dois comandos:

    ```
    $Session = New-PSSession -ConfigurationName Microsoft.Exchange -ConnectionUri https://ps.outlook.com/powershell/ -Credential $Cred -Authentication Basic –AllowRedirection
    ```

    ```
    Import-PSSession $Session
    ```

4.  Especifique a localização da chave de inquilino do Azure RMS, de acordo com a sua região:

    Para a América do Norte (e subscrições para a administração pública):

    ```
    Set-IRMConfiguration -RMSOnlineKeySharingLocation "https://sp-rms.na.aadrm.com/TenantManagement/ServicePartner.svc"
    ```
    Para Europa:

    ```
    Set-IRMConfiguration -RMSOnlineKeySharingLocation "https://sp-rms.eu.aadrm.com/TenantManagement/ServicePartner.svc"
    ```
    Da Ásia:

    ```
    Set-IRMConfiguration -RMSOnlineKeySharingLocation "https://sp-rms.ap.aadrm.com/TenantManagement/ServicePartner.svc"
    ```
    Da América do Sul:

    ```
    Set-IRMConfiguration -RMSOnlineKeySharingLocation "https://sp-rms.sa.aadrm.com/TenantManagement/ServicePartner.svc"
    ```

5.  Importar dados de configuração a partir do Azure RMS para o Exchange Online, sob a forma do domínio de publicação fidedigno (TPD). Isto inclui a chave de inquilino do Azure RMS e modelos do Azure RMS:

    ```
    Import-RMSTrustedPublishingDomain -RMSOnline -name "RMS Online"
    ```
    Este comando, utilizámos o nome de **do RMS Online** para o nome da base do TPD para o Azure RMS no Exchange Online. Depois do TPD é importado, é denominado **RMS Online - 1** no Exchange Online.

6.  Ative a funcionalidade de Azure RMS para que as funcionalidades de IRM estejam disponíveis para o Exchange Online:

    ```
    Set-IRMConfiguration -InternalLicensingEnabled $true
    ```
    Depois de executar este comando, o Rights Management é ativado automaticamente para o cliente do Outlook, o Outlook Web app e o Exchange Active Sync.

7.  Opcionalmente, teste se esta configuração é bem-sucedida, utilizando o seguinte comando:

    ```
    Test-IRMConfiguration -Sender <user email address>
    ```
    Por exemplo: **Test-IRMConfiguration -Sender  adams@contoso.com**

    Este comando executa uma série de verificações que inclui a verificar a conectividade ao serviço, a obter a configuração, a obter os URIs, licenças e todos os modelos. Na sessão do Windows PowerShell, irá ver os resultados de cada um e no final, se tudo passar estas verificações: **RESULTADO GERAL: PASS**

8.  Desliga a sua sessão remota do PowerShell:

    ```
    Remove-PSSession $Session
    ```

Os utilizadores agora podem proteger as respetivas mensagens de correio eletrónico utilizando o Azure RMS. Por exemplo, no Outlook Web App, selecione **definir permissões** a partir do menu adicional (**…**) e, em seguida, escolha **não reencaminhar** ou um dos modelos disponíveis para aplicar proteção de informações para a mensagem de correio eletrónico e quaisquer anexos. No entanto, porque o Outlook Web App coloca em cache da IU para um dia, aguarde que este período de tempo devem decorrer antes de tentar aplicar proteção de informações para mensagens de correio eletrónico e depois de executar estes comandos de configuração. Antes da IU de atualizações de forma a refletir a nova configuração, não verá as opções da **definir permissões** menu.

> [!IMPORTANT]
> Se criar novos [modelos personalizados](https://technet.microsoft.com/library/dn642472.aspx) para o Azure RMS ou atualizar os modelos, cada vez, tem de executar o seguinte comando do PowerShell do Exchange Online (se necessário, execute os passos 2 e 3 primeiro) para sincronizar essas alterações para o Exchange Online: `Import-RMSTrustedPublishingDomain -Name "RMS Online - 1" -RefreshTemplates –RMSOnline`

Como um administrador do Exchange, agora pode configurar as funcionalidades que aplicar a proteção de informações automaticamente, tais como [regras de transporte](https://technet.microsoft.com/library/dd302432.aspx), [políticas de prevenção (DLP) de perda de dados](https://technet.microsoft.com/library/jj150527%28v=exchg.150%29.aspx), e [protegidos voicemail](https://technet.microsoft.com/library/dn198211%28v=exchg.150%29.aspx) (Unified Messaging).

Para obter instruções detalhadas configurar o Exchange Online para ativar a funcionalidade IRM, consulte a documentação na biblioteca do Exchange. Por exemplo:

-   [Ligar ao Exchange Online utilizando o PowerShell remoto](https://technet.microsoft.com/library/jj984289%28v=exchg.160%29.aspx)

-   [Configurar a IRM para utilizar o Azure Rights Management](https://technet.microsoft.com/library/dn151475%28v=exchg.150%29.aspx)

#### Encriptação de mensagens do Office 365
Execute os mesmos passos como documentados na secção anterior, mas se não quiser modelos para ser apresentada, antes de passo 6, execute o seguinte comando para impedir que os modelos IRM seja disponíveis no Outlook Web App e cliente Outlook: `Set-IRMConfiguration -ClientAccessServerEnabled $false`

Em seguida, está pronto para configurar [regras de transporte](https://technet.microsoft.com/library/dd302432.aspx) para modificar automaticamente a segurança de mensagens quando os destinatários estão localizados fora da organização e seleciona a **Aplicar encriptação de mensagens do Office 365** opção.

Para mais informações sobre a encriptação de mensagens, consulte o artigo [encriptação no Office 365](https://technet.microsoft.com/library/dn569286.aspx) na biblioteca do Exchange.

### <a name="BKMK_SharePointOnline"></a>SharePoint Online e OneDrive para empresas: Configuração de IRM
Para configurar o SharePoint Online e OneDrive para empresas para suportar o Azure RMS, primeiro tem de ativar o serviço de gestão (IRM) de direitos de informação para o SharePoint Online utilizando o Centro de administração do SharePoint. Em seguida, os proprietários de sites podem proteger de IRM as respetivas listas do SharePoint e bibliotecas de documentos, e os utilizadores podem proteger IRM respetiva biblioteca do OneDrive para empresas para que os documentos que aí guardados e partilhados com outras pessoas, são automaticamente protegidos pelo Azure RMS.

Para ativar o serviço de gestão (IRM) de direitos de informação para o SharePoint Online, consulte as instruções seguintes a partir do Web site do Office:

-   [Configurar a gestão de direitos de informação (IRM) no Centro de administração do SharePoint](http://office.microsoft.com/office365-sharepoint-online-enterprise-help/set-up-information-rights-management-irm-insharepoint-online-HA102895193.aspx)

Esta configuração é efetuada pelo administrador do Office 365.

#### Configurar a IRM para listas e bibliotecas
Após ativar o serviço de IRM para o SharePoint, os proprietários de sites podem proteger o IRM as respetivas listas e bibliotecas de documentos do SharePoint. Para obter instruções, consulte o seguinte a partir do Web site do Office:

-   [Aplicar gestão de direitos de informação a uma lista ou biblioteca](http://office.microsoft.com/sharepoint-help/apply-information-rights-management-to-a-list-or-library-HA102891460.aspx)

Esta configuração é efetuada pelo administrador do site do SharePoint.

#### <a name="BKMK_OneDrive"></a>Configurar a IRM para o OneDrive para empresas
Após ativar o serviço de IRM para o SharePoint Online, os biblioteca do OneDrive utilizadores para empresas documento, em seguida, pode ser configurada para proteção de gestão de direitos.  Os utilizadores podem configurar isto para si próprio utilizando o **definições** ícone no seu OneDrive. Embora os administradores não é possível configurar a gestão de direitos do OneDrive utilizadores para empresas utilizando o Centro de administração do SharePoint, pode fazê-lo utilizando o Windows PowerShell.

> [!NOTE]
> Para obter mais informações sobre como configurar o OneDrive para empresas, consulte a documentação do Office,[Configure o OneDrive para empresas no Office 365](https://support.office.com/article/Set-up-OneDrive-for-Business-in-Office-365-3e21f8f0-e0a1-43be-aa3e-8c0236bf11bb).

##### Configuração para os utilizadores
Conceder a utilizadores estas instruções para que podem configurar o seu OneDrive para empresas e IRM-proteger os seus ficheiros empresariais.

1.  No OneDrive, clique na **definições** ícone, para abrir o menu de definições e, em seguida, clique em **conteúdos do Site**.

2.  Paire sobre o **documentos** mosaico, escolha nas reticências (**…**) e, em seguida, clique em **definições.**

3.  No **definições** página, no **permissões e gestão** secção, clique em **Information Rights Management**.

4.  No **definições de gestão de direitos de informação** página, selecione **restringir as permissões nesta biblioteca em transferência** caixa de verificação, especifique a sua escolha de nome e uma descrição para as permissões e, opcionalmente, clique em **Mostrar opções** para configurar as configurações opcionais e, em seguida, clique em **OK**.

    Para mais informações sobre as opções de configuração, consulte as instruções em [Aplicar gestão de direitos de informação a uma lista ou biblioteca](https://support.office.com/article/Apply-Information-Rights-Management-to-a-list-or-library-3bdb5c4e-94fc-4741-b02f-4e7cc3c54aa1) da documentação do Office.

Porque esta configuração baseia-se os utilizadores em vez de um administrador para proteger IRM respetiva biblioteca do OneDrive para empresas, informe os utilizadores sobre os benefícios de proteger os seus ficheiros e como efetuar esta ação. Por exemplo, explicam se quando partilham um documento a partir do OneDrive para empresas, apenas as pessoas que autorizar o acesso com restrições que é configurado, mesmo que o ficheiro é alterado e copiadas noutro.

##### Configuração para administradores
Apesar de não é possível configurar a IRM do OneDrive utilizadores para empresas utilizando o Centro de administração do SharePoint, pode fazê-lo utilizando o Windows PowerShell. Para ativar a IRM para estas bibliotecas, siga estes passos:

1.  Transfira e instale o [SDK de componentes do SharePoint Online cliente](http://www.microsoft.com/en-us/download/details.aspx?id=42038).

2.  Transfira e instale o [Shell de gestão do SharePoint Online](http://www.microsoft.com/en-us/download/details.aspx?id=35588).

3.  Copie o conteúdo do script que se segue e nome ao ficheiro conjunto IRMOnOneDriveForBusiness.ps1 no seu computador.

    *&#42;&#42;Exclusão de responsabilidade&#42;&#42;*: Este script de exemplo não é suportado em qualquer serviço ou programa de suporte padrão da Microsoft. Este script de exemplo é fornecido como é, sem garantias de qualquer tipo.

    ```
    # Requires Windows PowerShell version 3 <# Description: Configures IRM policy settings for OneDrive for Business and can also be used for SharePoint Online libraries and lists Script Installation Requirements: SharePoint Online Client Components SDK http://www.microsoft.com/en-us/download/details.aspx?id=42038 SharePoint Online Management Shell http://www.microsoft.com/en-us/download/details.aspx?id=35588 ====== #> # URL will be in the format https://<tenant-name>-admin.sharepoint.com $sharepointAdminCenterUrl = "https://contoso-admin.sharepoint.com" $tenantAdmin = "admin@contoso.com" $webUrls = @("https://contoso-my.sharepoint.com/personal/user1_contoso_com", "https://contoso-my.sharepoint.com/personal/user2_contoso_com", "https://contoso-my.sharepoint.com/personal/user3_contoso_com") <# As an alternative to specifying the URLs as an array, you can import them from a CSV file (no header, single value per row). Then, use: $webUrls = Get-Content -Path "File_path_and_name.csv" #> $listTitle = "Documents" function Load-SharePointOnlineClientComponentAssemblies { [cmdletbinding()] param() process { # assembly location: C:\Program Files\Common Files\microsoft shared\Web Server Extensions\16\ISAPI try { Write-Verbose "Loading Assembly: Microsoft.Office.Client.Policy, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.Office.Client.Policy, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.Office.Client.TranslationServices, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.Office.Client.TranslationServices, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.SharePoint.Client, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.SharePoint.Client, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.SharePoint.Client.DocumentManagement, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.SharePoint.Client.DocumentManagement, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.SharePoint.Client.Publishing, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.SharePoint.Client.Publishing, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.SharePoint.Client.Runtime, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.SharePoint.Client.Runtime, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.SharePoint.Client.Search.Applications, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.SharePoint.Client.Search.Applications, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.SharePoint.Client.Search, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.SharePoint.Client.Search, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.SharePoint.Client.Taxonomy, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.SharePoint.Client.Taxonomy, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.SharePoint.Client.UserProfiles, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.SharePoint.Client.UserProfiles, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null return $true } catch { if($_.Exception.Message -match "Could not load file or assembly") { Write-Error -Message "Unable to load the SharePoint Server 2013 Client Components.`nDownload Location: http://www.microsoft.com/en-us/download/details.aspx?id=42038" } else { Write-Error -Exception $_.Exception } return $false } } } function Load-SharePointOnlineModule { [cmdletbinding()] param() process { do { # Installation location: C:\Program Files\SharePoint Online Management Shell\Microsoft.Online.SharePoint.PowerShell $spoModule = Get-Module -Name Microsoft.Online.SharePoint.PowerShell -ErrorAction SilentlyContinue if(-not $spoModule) { try { Import-Module Microsoft.Online.SharePoint.PowerShell -DisableNameChecking return $true } catch { if($_.Exception.Message -match "Could not load file or assembly") { Write-Error -Message "Unable to load the SharePoint Online Management Shell.`nDownload Location: http://www.microsoft.com/en-us/download/details.aspx?id=35588" } else { Write-Error -Exception $_.Exception } return $false } } else { return $true } } while(-not $spoModule) } } function Set-IrmConfiguration { [cmdletbinding()] param( [parameter(Mandatory=$true)][Microsoft.SharePoint.Client.List]$List, [parameter(Mandatory=$true)][string]$PolicyTitle, [parameter(Mandatory=$true)][string]$PolicyDescription, [parameter(Mandatory=$false)][switch]$IrmReject, [parameter(Mandatory=$false)][DateTime]$ProtectionExpirationDate, [parameter(Mandatory=$false)][switch]$DisableDocumentBrowserView, [parameter(Mandatory=$false)][switch]$AllowPrint, [parameter(Mandatory=$false)][switch]$AllowScript, [parameter(Mandatory=$false)][switch]$AllowWriteCopy, [parameter(Mandatory=$false)][int]$DocumentAccessExpireDays, [parameter(Mandatory=$false)][int]$LicenseCacheExpireDays, [parameter(Mandatory=$false)][string]$GroupName ) process { Write-Verbose "Applying IRM Configuration on '$($List.Title)'" # reset the value to the default settings $list.InformationRightsManagementSettings.Reset() $list.IrmEnabled = $true # IRM Policy title and description $list.InformationRightsManagementSettings.PolicyTitle       = $PolicyTitle $list.InformationRightsManagementSettings.PolicyDescription = $PolicyDescription # Set additional IRM library settings # Do not allow users to upload documents that do not support IRM $list.IrmReject = $IrmReject.IsPresent $parsedDate = Get-Date if([DateTime]::TryParse($ProtectionExpirationDate, [ref]$parsedDate)) { # Stop restricting access to the library at <date> $list.IrmExpire = $true $list.InformationRightsManagementSettings.DocumentLibraryProtectionExpireDate = $ProtectionExpirationDate } # Prevent opening documents in the browser for this Document Library $list.InformationRightsManagementSettings.DisableDocumentBrowserView = $DisableDocumentBrowserView.IsPresent # Configure document access rights # Allow viewers to print $list.InformationRightsManagementSettings.AllowPrint = $AllowPrint.IsPresent # Allow viewers to run script and screen reader to function on downloaded documents $list.InformationRightsManagementSettings.AllowScript = $AllowScript.IsPresent # Allow viewers to write on a copy of the downloaded document $list.InformationRightsManagementSettings.AllowWriteCopy = $AllowWriteCopy.IsPresent if($DocumentAccessExpireDays) { # After download, document access rights will expire after these number of days (1-365) $list.InformationRightsManagementSettings.EnableDocumentAccessExpire = $true $list.InformationRightsManagementSettings.DocumentAccessExpireDays   = $DocumentAccessExpireDays } # Set group protection and credentials interval if($LicenseCacheExpireDays) { # Users must verify their credentials using this interval (days) $list.InformationRightsManagementSettings.EnableLicenseCacheExpire = $true $list.InformationRightsManagementSettings.LicenseCacheExpireDays   = $LicenseCacheExpireDays } if($GroupName) { # Allow group protection. Default group: $list.InformationRightsManagementSettings.EnableGroupProtection = $true $list.InformationRightsManagementSettings.GroupName             = $GroupName } } end { if($list) { Write-Verbose "Committing IRM configuration settings on '$($list.Title)'" $list.InformationRightsManagementSettings.Update() $list.Update() $script:clientContext.Load($list) $script:clientContext.ExecuteQuery() } } } function Get-CredentialFromCredentialCache { [cmdletbinding()] param([string]$CredentialName) #if( Test-Path variable:\global:CredentialCache ) if( Get-Variable O365TenantAdminCredentialCache -Scope Global -ErrorAction SilentlyContinue ) { if($global:O365TenantAdminCredentialCache.ContainsKey($CredentialName)) { Write-Verbose "Credential Cache Hit: $CredentialName" return $global:O365TenantAdminCredentialCache[$CredentialName] } } Write-Verbose "Credential Cache Miss: $CredentialName" return $null } function Add-CredentialToCredentialCache { [cmdletbinding()] param([System.Management.Automation.PSCredential]$Credential) if(-not (Get-Variable CredentialCache -Scope Global -ErrorAction SilentlyContinue)) { Write-Verbose "Initializing the Credential Cache" $global:O365TenantAdminCredentialCache = @{} } Write-Verbose "Adding Credential to the Credential Cache" $global:O365TenantAdminCredentialCache[$Credential.UserName] = $Credential } # load the required assemblies and Windows PowerShell modules if(-not ((Load-SharePointOnlineClientComponentAssemblies) -and (Load-SharePointOnlineModule)) ) { return } # Add the credentials to the client context and SharePoint Online service connection # check for cached credentials to use $o365TenantAdminCredential = Get-CredentialFromCredentialCache -CredentialName $tenantAdmin if(-not $o365TenantAdminCredential) { # when credentials are not cached, prompt for the tenant admin credentials $o365TenantAdminCredential = Get-Credential -UserName $tenantAdmin -Message "Enter the password for the Office 365 admin" if(-not $o365TenantAdminCredential -or -not $o365TenantAdminCredential.UserName -or $o365TenantAdminCredential.Password.Length -eq 0 ) { Write-Error -Message "Could not validate the supplied tenant admin credentials" return } # add the credentials to the cache Add-CredentialToCredentialCache -Credential $o365TenantAdminCredential } # connect to Office365 first, required for SharePoint Online cmdlets to run Connect-SPOService -Url $sharepointAdminCenterUrl -Credential $o365TenantAdminCredential # enumerate each of the specified site URLs foreach($webUrl in $webUrls) { $grantedSiteCollectionAdmin = $false try { # establish the client context and set the credentials to connect to the site $script:clientContext = New-Object Microsoft.SharePoint.Client.ClientContext($webUrl) $script:clientContext.Credentials = New-Object Microsoft.SharePoint.Client.SharePointOnlineCredentials($o365TenantAdminCredential.UserName, $o365TenantAdminCredential.Password) # initialize the site and web context $script:clientContext.Load($script:clientContext.Site) $script:clientContext.Load($script:clientContext.Web) $script:clientContext.ExecuteQuery() # load and ensure the tenant admin user account if present on the target SharePoint site $tenantAdminUser = $script:clientContext.Web.EnsureUser($o365TenantAdminCredential.UserName) $script:clientContext.Load($tenantAdminUser) $script:clientContext.ExecuteQuery() # check if the tenant admin is a site admin if( -not $tenantAdminUser.IsSiteAdmin ) { try { # grant the tenant admin temporary admin rights to the site collection Set-SPOUser -Site $script:clientContext.Site.Url -LoginName $o365TenantAdminCredential.UserName -IsSiteCollectionAdmin $true | Out-Null $grantedSiteCollectionAdmin = $true } catch { Write-Error $_.Exception return } } try { # load the list orlibrary using CSOM $list = $null $list = $script:clientContext.Web.Lists.GetByTitle($listTitle) $script:clientContext.Load($list) $script:clientContext.ExecuteQuery() # **************  ADMIN INSTRUCTIONS  ************** # If necessary, modify the following Set-IrmConfiguration parameters to match your required values # The supplied options and values are for example only # Example that shows the Set-IrmConfiguration command with all parameters: Set-IrmConfiguration -List $list -PolicyTitle "Protected Files" -PolicyDescription "This policy restricts access to authorized users" -IrmReject -ProtectionExpirationDate $(Get-Date).AddDays(180) -DisableDocumentBrowserView -AllowPrint -AllowScript -AllowWriteCopy -LicenseCacheExpireDays 25 -DocumentAccessExpireDays 90 Set-IrmConfiguration -List $list -PolicyTitle "Protected Files" -PolicyDescription "This policy restricts access to authorized users" } catch { Write-Error -Message "Error setting IRM configuration on site: $webUrl.`nError Details: $($_.Exception.ToString())" } } finally { if($grantedSiteCollectionAdmin) { # remove the temporary admin rights to the site collection Set-SPOUser -Site $script:clientContext.Site.Url -LoginName $o365TenantAdminCredential.UserName -IsSiteCollectionAdmin $false | Out-Null } } } Disconnect-SPOService -ErrorAction SilentlyContinue
    ```

4.  Reveja o script e efetuar as seguintes alterações:

    1.  Procurar `$sharepointAdminCenterUrl` e substitua o valor de exemplo com o seu URL do Centro de administração SharePoint.

        Pode encontrar este valor como o URL de base quando entrar Centro de administração do SharePoint e tem o seguinte formato: https://*&lt; tenant_name &gt;*-admin.sharepoint.com

        Por exemplo, se o nome do inquilino for "contoso", em seguida, tem de especificar: **https://contoso-admin.sharepoint.com**

    2.  Procurar `$tenantAdmin` e substitua o valor de exemplo com a sua própria conta de administrador global completamente qualificado para o Office 365.

        Este valor é o mesmo da que utiliza para iniciar sessão portal de administração do Office 365 como administrador global e tem o seguinte formato: user_name @*&lt; nome do domínio inquilino &gt;*.com

        Por exemplo, se o nome de utilizador de administrador global do Office 365 for "admin" para o domínio de inquilino "contoso.com", tem de especificar: **admin@contoso.com**

    3.  Procurar `$webUrls` e substitua os valores de exemplo com do OneDrive os seus utilizadores para empresas os URLs da web, adicionar ou eliminar entradas tantos conforme necessário.

        Em alternativa, ver os comentários no script sobre como substituir esta matriz através da importação de um. Ficheiro CSV que contém todos os URLs tem de configurar.  Fornecemos outro script de exemplo para procurar automaticamente e extrair os URLs para preencher esta. Ficheiro CSV. Quando estiver pronto para efetuar este procedimento, expanda o [Script adicional para todos os OneDrive de saída para os URLs de negócios para um. Ficheiro CSV](#BKMK_Script_OD4B_URLS) secção imediatamente a seguir estes passos.

        Web está de URL para do OneDrive o utilizador para empresas no seguinte formato: https://*&lt; nome do inquilino &gt;*-my.sharepoint.com/personal/*&lt; user_name &gt;*_*&lt; nome do inquilino &gt;*_com

        Por exemplo, se o utilizador no inquilino contoso tiver um nome de utilizador de "rsimone", tem de especificar: **https://contoso-my.sharepoint.com/personal/rsimone_contoso_com**

    4.  Uma vez que podemos estiver a utilizar o script para configurar o OneDrive para empresas, não altere o valor de **Documents** para o `$listTitle` variável.

    5.  Procurar `ADMIN INSTRUCTIONS`. Se lhe não efetuar alterações nesta secção, o OneDrive o utilizador para empresas será configurado para IRM com o título da política de "Ficheiros protegidos" e a descrição "Esta política restringe o acesso a utilizadores autorizados".  Não existem outras opções de IRM serão definidas, que é provavelmente adequada para a maioria dos ambientes. No entanto, pode alterar o título de sugestões de política e a descrição e também adicionar quaisquer outras opções de IRM que são adequadas para o seu ambiente. Consulte o exemplo no script para o ajudar a construir o seu próprio conjunto de parâmetros para o comando Set-IrmConfiguration comentado.

5.  Guarde o script e inicie-lo. Se não iniciar o script (mais seguro), tem de configurar o Windows PowerShell no seu computador para executar scripts não assinados. Para tal, execute uma sessão do Windows PowerShell com o **Executar como administrador** opção e tipo: **Set-ExecutionPolicy Unrestricted**. No entanto, esta configuração permite executar (menos seguro) de scripts não assinados tudo.

    Para obter mais informações sobre como iniciar sessão scripts do Windows PowerShell, consulte o artigo [about_Signing](https://technet.microsoft.com/library/hh847874.aspx) na biblioteca de documentação do PowerShell.

6.  Execute o script e se lhe for solicitado, forneça a palavra-passe para a conta de administrador do Office 365. Se modificar o script e execute-o na mesma sessão do Windows PowerShell, não serão pedidas credenciais.

> [!TIP]
> Também pode utilizar este script para configurar a IRM para uma biblioteca do SharePoint Online. Para esta configuração, irá provavelmente pretende ativar a opção adicional **não permitir que os utilizadores carreguem documentos que não suportem IRM**, para se certificar de que a biblioteca contém apenas protegidos documentos.    Para o fazer, adicionar o `-IrmReject` parâmetro para o comando Set-IrmConfiguration no script.
> 
> Também terá de modificar o `$webUrls` variável (por exemplo, **https://contoso.sharepoint.com**) e  `$listTitle` variável (por exemplo, **$Reports**).

Se tiver de desativar a IRM para o OneDrive do utilizador para as bibliotecas de negócio, expanda o [Script ao desativar a IRM para o OneDrive para empresas](#BKMK_Script_OD4B_DisableIRM) secção.

###### <a name="BKMK_Script_OD4B_URLS"></a>Script adicional para todos os OneDrive de saída para os URLs de negócios para um. Ficheiro CSV
Passo 4c acima, pode utilizar o seguinte script do Windows PowerShell para extrair os URLs para do OneDrive todos os utilizadores para bibliotecas de negócio, o que pode, em seguida, verifique, editar se for necessário e, em seguida, importar para o script principal.

Este script também requer a [SDK de componentes do SharePoint Online cliente](http://www.microsoft.com/en-us/download/details.aspx?id=42038) e [Shell de gestão do SharePoint Online](http://www.microsoft.com/en-us/download/details.aspx?id=35588). Siga as instruções mesmas para copiar e colá-la, guarde o ficheiro localmente (por exemplo, "relatório-OneDriveForBusinessSiteInfo.ps1"), modifique o   `$sharepointAdminCenterUrl` e `$tenantAdmin` valores como antes e depois execute o script.

*&#42;&#42;Exclusão de responsabilidade&#42;&#42;*: Este script de exemplo não é suportado em qualquer serviço ou programa de suporte padrão da Microsoft. Este script de exemplo é fornecido como é, sem garantias de qualquer tipo.

```
# Requires Windows PowerShell version 3 <# Description: Queries the search service of an Office 365 tenant to retrieve all OneDrive for Business sites. Details of the discovered sites are written to a .CSV file (by default,"OneDriveForBusinessSiteInfo_<date>.csv"). Script Installation Requirements: SharePoint Online Client Components SDK http://www.microsoft.com/en-us/download/details.aspx?id=42038 SharePoint Online Management Shell http://www.microsoft.com/en-us/download/details.aspx?id=35588 ====== #> # URL will be in the format https://<tenant-name>-admin.sharepoint.com $sharepointAdminCenterUrl = "https://contoso-admin.sharepoint.com" $tenantAdmin = "admin@contoso.onmicrosoft.com" $reportName = "OneDriveForBusinessSiteInfo_$((Get-Date).ToString("yyyy-MM-dd_hh.mm.ss")).csv" $oneDriveForBusinessSiteUrls= @() $resultsProcessed = 0 function Load-SharePointOnlineClientComponentAssemblies { [cmdletbinding()] param() process { # assembly location: C:\Program Files\Common Files\microsoft shared\Web Server Extensions\16\ISAPI try { Write-Verbose "Loading Assembly: Microsoft.Office.Client.Policy, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.Office.Client.Policy, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.Office.Client.TranslationServices, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.Office.Client.TranslationServices, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.SharePoint.Client, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.SharePoint.Client, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.SharePoint.Client.DocumentManagement, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.SharePoint.Client.DocumentManagement, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.SharePoint.Client.Publishing, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.SharePoint.Client.Publishing, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.SharePoint.Client.Runtime, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.SharePoint.Client.Runtime, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.SharePoint.Client.Search.Applications, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.SharePoint.Client.Search.Applications, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.SharePoint.Client.Search, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.SharePoint.Client.Search, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.SharePoint.Client.Taxonomy, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.SharePoint.Client.Taxonomy, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.SharePoint.Client.UserProfiles, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.SharePoint.Client.UserProfiles, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null return $true } catch { if($_.Exception.Message -match "Could not load file or assembly") { Write-Error -Message "Unable to load the SharePoint Server 2013 Client Components.`nDownload Location: http://www.microsoft.com/en-us/download/details.aspx?id=42038" } else { Write-Error -Exception $_.Exception } return $false } } } function Load-SharePointOnlineModule { [cmdletbinding()] param() process { do { # Installation location: C:\Program Files\SharePoint Online Management Shell\Microsoft.Online.SharePoint.PowerShell $spoModule = Get-Module -Name Microsoft.Online.SharePoint.PowerShell -ErrorAction SilentlyContinue if(-not $spoModule) { try { Import-Module Microsoft.Online.SharePoint.PowerShell -DisableNameChecking return $true } catch { if($_.Exception.Message -match "Could not load file or assembly") { Write-Error -Message "Unable to load the SharePoint Online Management Shell.`nDownload Location: http://www.microsoft.com/en-us/download/details.aspx?id=35588" } else { Write-Error -Exception $_.Exception } return $false } } else { return $true } } while(-not $spoModule) } } function Get-CredentialFromCredentialCache { [cmdletbinding()] param([string]$CredentialName) #if( Test-Path variable:\global:CredentialCache ) if( Get-Variable O365TenantAdminCredentialCache -Scope Global -ErrorAction SilentlyContinue ) { if($global:O365TenantAdminCredentialCache.ContainsKey($CredentialName)) { Write-Verbose "Credential Cache Hit: $CredentialName" return $global:O365TenantAdminCredentialCache[$CredentialName] } } Write-Verbose "Credential Cache Miss: $CredentialName" return $null } function Add-CredentialToCredentialCache { [cmdletbinding()] param([System.Management.Automation.PSCredential]$Credential) if(-not (Get-Variable CredentialCache -Scope Global -ErrorAction SilentlyContinue)) { Write-Verbose "Initializing the Credential Cache" $global:O365TenantAdminCredentialCache = @{} } Write-Verbose "Adding Credential to the Credential Cache" $global:O365TenantAdminCredentialCache[$Credential.UserName] = $Credential } # load the required assemblies and Windows PowerShell modules if(-not ((Load-SharePointOnlineClientComponentAssemblies) -and (Load-SharePointOnlineModule)) ) { return } # Add the credentials to the client context and SharePoint Online service connection # check for cached credentials to use $o365TenantAdminCredential = Get-CredentialFromCredentialCache -CredentialName $tenantAdmin if(-not $o365TenantAdminCredential) { # when credentials are not cached, prompt for the tenant admin credentials $o365TenantAdminCredential = Get-Credential -UserName $tenantAdmin -Message "Enter the password for the Office 365 admin" if(-not $o365TenantAdminCredential -or -not $o365TenantAdminCredential.UserName -or $o365TenantAdminCredential.Password.Length -eq 0 ) { Write-Error -Message "Could not validate the supplied tenant admin credentials" return } # add the credentials to the cache Add-CredentialToCredentialCache -Credential $o365TenantAdminCredential } # establish the client context and set the credentials to connect to the site $clientContext = New-Object Microsoft.SharePoint.Client.ClientContext($sharepointAdminCenterUrl) $clientContext.Credentials = New-Object Microsoft.SharePoint.Client.SharePointOnlineCredentials($o365TenantAdminCredential.UserName, $o365TenantAdminCredential.Password) # run a query against the Office 365 tenant search service to retrieve all OneDrive for Business URLs do { # build the query object $query = New-Object Microsoft.SharePoint.Client.Search.Query.KeywordQuery($clientContext) $query.TrimDuplicates        = $false $query.RowLimit              = 500 $query.QueryText             = "SPSiteUrl:'/personal/' AND contentclass:STS_Site" $query.StartRow              = $resultsProcessed $query.TotalRowsExactMinimum = 500000 # run the query $searchExecutor = New-Object Microsoft.SharePoint.Client.Search.Query.SearchExecutor($clientContext) $queryResults = $searchExecutor.ExecuteQuery($query) $clientContext.ExecuteQuery() # enumerate the search results and store the site URLs $queryResults.Value[0].ResultRows | % { $oneDriveForBusinessSiteUrls += $_.Path $resultsProcessed++ } } while($resultsProcessed -lt $queryResults.Value.TotalRows) $oneDriveForBusinessSiteUrls | Out-File -FilePath $reportName
```

###### <a name="BKMK_Script_OD4B_DisableIRM"></a>Script ao desativar a IRM para o OneDrive para empresas
Utilize o seguinte script de exemplo, se tiver de desativar a IRM para o OneDrive para empresas dos utilizadores.

Este script também requer a [SDK de componentes do SharePoint Online cliente](http://www.microsoft.com/en-us/download/details.aspx?id=42038) e [Shell de gestão do SharePoint Online](http://www.microsoft.com/en-us/download/details.aspx?id=35588). Copiar e colar o conteúdo, guarde o ficheiro localmente (por exemplo, "desativar-IRMOnOneDriveForBusiness.ps1") e modificar o   `$sharepointAdminCenterUrl` e `$tenantAdmin` valores. Especifique o OneDrive para empresas URLs ou utilizar o script na secção anterior, para que possa importar estes e, em seguida, execute o script manualmente.

*&#42;&#42;Exclusão de responsabilidade&#42;&#42;*: Este script de exemplo não é suportado em qualquer serviço ou programa de suporte padrão da Microsoft. Este script de exemplo é fornecido como é, sem garantias de qualquer tipo.

```
# Requires Windows PowerShell version 3 <# Description: Disables IRM for OneDrive for Business and can also be used for SharePoint Online libraries and lists Script Installation Requirements: SharePoint Online Client Components SDK http://www.microsoft.com/en-us/download/details.aspx?id=42038 SharePoint Online Management Shell http://www.microsoft.com/en-us/download/details.aspx?id=35588 ====== #> $sharepointAdminCenterUrl = "https://contoso-admin.sharepoint.com" $tenantAdmin = "admin@contoso.com" $webUrls = @("https://contoso-my.sharepoint.com/personal/user1_contoso_com", "https://contoso-my.sharepoint.com/personal/user2_contoso_com", "https://contoso-my.sharepoint.com/personal/person3_contoso_com") <# As an alternative to specifying the URLs as an array, you can import them from a CSV file (no header, single value per row). Then, use: $webUrls = Get-Content -Path "File_path_and_name.csv" #> $listTitle = "Documents" function Load-SharePointOnlineClientComponentAssemblies { [cmdletbinding()] param() process { # assembly location: C:\Program Files\Common Files\microsoft shared\Web Server Extensions\16\ISAPI try { Write-Verbose "Loading Assembly: Microsoft.Office.Client.Policy, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.Office.Client.Policy, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.Office.Client.TranslationServices, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.Office.Client.TranslationServices, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.SharePoint.Client, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.SharePoint.Client, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.SharePoint.Client.DocumentManagement, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.SharePoint.Client.DocumentManagement, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.SharePoint.Client.Publishing, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.SharePoint.Client.Publishing, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.SharePoint.Client.Runtime, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.SharePoint.Client.Runtime, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.SharePoint.Client.Search.Applications, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.SharePoint.Client.Search.Applications, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.SharePoint.Client.Search, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.SharePoint.Client.Search, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.SharePoint.Client.Taxonomy, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.SharePoint.Client.Taxonomy, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.SharePoint.Client.UserProfiles, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.SharePoint.Client.UserProfiles, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null return $true } catch { if($_.Exception.Message -match "Could not load file or assembly") { Write-Error -Message "Unable to load the SharePoint Server 2013 Client Components.`nDownload Location: http://www.microsoft.com/en-us/download/details.aspx?id=42038" } else { Write-Error -Exception $_.Exception } return $false } } } function Load-SharePointOnlineModule { [cmdletbinding()] param() process { do { # Installation location: C:\Program Files\SharePoint Online Management Shell\Microsoft.Online.SharePoint.PowerShell $spoModule = Get-Module -Name Microsoft.Online.SharePoint.PowerShell -ErrorAction SilentlyContinue if(-not $spoModule) { try { Import-Module Microsoft.Online.SharePoint.PowerShell -DisableNameChecking return $true } catch { if($_.Exception.Message -match "Could not load file or assembly") { Write-Error -Message "Unable to load the SharePoint Online Management Shell.`nDownload Location: http://www.microsoft.com/en-us/download/details.aspx?id=35588" } else { Write-Error -Exception $_.Exception } return $false } } else { return $true } } while(-not $spoModule) } } function Remove-IrmConfiguration { [cmdletbinding()] param( [parameter(Mandatory=$true)][Microsoft.SharePoint.Client.List]$List ) process { Write-Verbose "Disabling IRM Configuration on '$($List.Title)'" $List.IrmEnabled = $false $List.IrmExpire  = $false $List.IrmReject  = $false $List.InformationRightsManagementSettings.Reset() } end { if($List) { Write-Verbose "Committing IRM configuration settings on '$($list.Title)'" $list.InformationRightsManagementSettings.Update() $list.Update() $script:clientContext.Load($list) $script:clientContext.ExecuteQuery() } } } function Get-CredentialFromCredentialCache { [cmdletbinding()] param([string]$CredentialName) #if( Test-Path variable:\global:CredentialCache ) if( Get-Variable O365TenantAdminCredentialCache -Scope Global -ErrorAction SilentlyContinue ) { if($global:O365TenantAdminCredentialCache.ContainsKey($CredentialName)) { Write-Verbose "Credential Cache Hit: $CredentialName" return $global:O365TenantAdminCredentialCache[$CredentialName] } } Write-Verbose "Credential Cache Miss: $CredentialName" return $null } function Add-CredentialToCredentialCache { [cmdletbinding()] param([System.Management.Automation.PSCredential]$Credential) if(-not (Get-Variable CredentialCache -Scope Global -ErrorAction SilentlyContinue)) { Write-Verbose "Initializing the Credential Cache" $global:O365TenantAdminCredentialCache = @{} } Write-Verbose "Adding Credential to the Credential Cache" $global:O365TenantAdminCredentialCache[$Credential.UserName] = $Credential } # load the required assemblies and Windows PowerShell modules if(-not ((Load-SharePointOnlineClientComponentAssemblies) -and (Load-SharePointOnlineModule)) ) { return } # Add the credentials to the client context and SharePoint Online service connection # check for cached credentials to use $o365TenantAdminCredential = Get-CredentialFromCredentialCache -CredentialName $tenantAdmin if(-not $o365TenantAdminCredential) { # when credentials are not cached, prompt for the tenant admin credentials $o365TenantAdminCredential = Get-Credential -UserName $tenantAdmin -Message "Enter the password for the Office 365 admin" if(-not $o365TenantAdminCredential -or -not $o365TenantAdminCredential.UserName -or $o365TenantAdminCredential.Password.Length -eq 0 ) { Write-Error -Message "Could not validate the supplied tenant admin credentials" return } # add the credentials to the cache Add-CredentialToCredentialCache -Credential $o365TenantAdminCredential } # connect to Office365 first, required for SharePoint Online cmdlets to run Connect-SPOService -Url $sharepointAdminCenterUrl -Credential $o365TenantAdminCredential # enumerate each of the specified site URLs foreach($webUrl in $webUrls) { $grantedSiteCollectionAdmin = $false try { # establish the client context and set the credentials to connect to the site $script:clientContext = New-Object Microsoft.SharePoint.Client.ClientContext($webUrl) $script:clientContext.Credentials = New-Object Microsoft.SharePoint.Client.SharePointOnlineCredentials($o365TenantAdminCredential.UserName, $o365TenantAdminCredential.Password) # initialize the site and web context $script:clientContext.Load($script:clientContext.Site) $script:clientContext.Load($script:clientContext.Web) $script:clientContext.ExecuteQuery() # load and ensure the tenant admin user account if present on the target SharePoint site $tenantAdminUser = $script:clientContext.Web.EnsureUser($o365TenantAdminCredential.UserName) $script:clientContext.Load($tenantAdminUser) $script:clientContext.ExecuteQuery() # check if the tenant admin is a site admin if( -not $tenantAdminUser.IsSiteAdmin ) { try { # grant the tenant admin temporary admin rights to the site collection Set-SPOUser -Site $script:clientContext.Site.Url -LoginName $o365TenantAdminCredential.UserName -IsSiteCollectionAdmin $true | Out-Null $grantedSiteCollectionAdmin = $true } catch { Write-Error $_.Exception return } } try { # load the list orlibrary using CSOM $list = $null $list = $script:clientContext.Web.Lists.GetByTitle($listTitle) $script:clientContext.Load($list) $script:clientContext.ExecuteQuery() Remove-IrmConfiguration -List $list } catch { Write-Error -Message "Error setting IRM configuration on site: $webUrl.`nError Details: $($_.Exception.ToString())" } } finally { if($grantedSiteCollectionAdmin) { # remove the temporary admin rights to the site collection Set-SPOUser -Site $script:clientContext.Site.Url -LoginName $o365TenantAdminCredential.UserName -IsSiteCollectionAdmin $false | Out-Null } } } Disconnect-SPOService -ErrorAction SilentlyContinue
```

## <a name="BKMK_Office2013Configuration"></a>2016 do Office e Office 2013: Configuração de clientes
Porque estas versões posteriores do Office suportam nativamente o Azure RMS, é necessária para suportar as funcionalidades de gestão (IRM) de direitos de informação para aplicações, como o Word, Excel, PowerPoint, Outlook e o Outlook Web App nenhuma configuração de computador do cliente. Todos os utilizadores tem de fazer é iniciar sessão para as suas aplicações do Office com os respetivos [!INCLUDE[o365_1](../Token/o365_1_md.md)] credenciais e podem proteger ficheiros e mensagens de correio eletrónico e utilizar ficheiros e mensagens de correio eletrónico que foram protegidas por outros utilizadores.

No entanto, recomendamos que complementar estas aplicações com a gestão de direitos de partilha de aplicações, para que os utilizadores acedam a vantagem do Office, suplementos. Para obter mais informações, consulte o [Aplicação de partilha Rights Management: Instalação e configuração de clientes](../Topic/Configuring_Applications_for_Azure_Rights_Management.md#BKMK_SharingApp) deste tópico.

## <a name="BKMK_Office2010Configuration"></a>Office 2010: Configuração de clientes
Para computadores de cliente utilizar o Azure RMS com o Office 2010, estes deverá ter sido instalado a aplicação de partilha Rights Management para Windows. Não é necessária nenhuma configuração adicional diferente de utilizadores tem de iniciar sessão com as respetivas [!INCLUDE[o365_1](../Token/o365_1_md.md)] credenciais e, em seguida, pode proteger ficheiros e utilizar ficheiros que foram protegidos por outros utilizadores.

Para mais informações sobre a aplicação de partilha Rights Management, consulte o [Aplicação de partilha Rights Management: Instalação e configuração de clientes](../Topic/Configuring_Applications_for_Azure_Rights_Management.md#BKMK_SharingApp) deste tópico.

## <a name="BKMK_SharingApp"></a>Aplicação de partilha Rights Management: Instalação e configuração de clientes
A gestão de direitos (RMS) aplicação de partilha é necessário para computadores de cliente utilizar o Azure RMS com o Office 2010 e recomendados para todos os computadores e dispositivos móveis que suportam o Azure RMS. A aplicação de partilha RMS integra-se com o Office aplicações através da instalação de um escritório suplemento, para que os utilizadores facilmente podem proteger ficheiros e mensagens de correio eletrónico diretamente a partir do Friso. Também oferece proteção genérica para tipos de ficheiros que não são suportados nativamente pelo Azure RMS e um site para utilizadores de monotorização de documentos para monitorizar e revogar ficheiros que estão protegidos.

### <a name="BKMK_SharingAppforWindows"></a>Aplicação de partilha RMS para Windows: Instalação e configuração
Para instalar e configurar a aplicação para o Windows para a implementação de uma empresa de partilha RMS, consulte o [Guia do administrador aplicação partilha Rights Management](http://technet.microsoft.com/library/dn339003.aspx).

> [!TIP]
> Se pretender instalar rapidamente e testar a aplicação para um único computador de partilha RMS, consulte o artigo [Transferir e instalar a aplicação de partilha Rights Management](http://technet.microsoft.com/library/dn574734.aspx) a partir de [Guia de utilizador de aplicação partilha Rights Management](http://technet.microsoft.com/library/dn339006.aspx).

### <a name="BKMK_SharingAppMovileDevices"></a>Aplicação de partilha RMS para plataformas móveis: Instalação
Para instalar a aplicação para plataformas móveis de partilha RMS, pode transferir a aplicação relevante utilizando as ligações no [página Microsoft Rights Management](http://go.microsoft.com/fwlink/?LinkId=303970). Não é necessária nenhuma configuração para utilizar o Azure RMS com esta aplicação.

## <a name="BKMK_RMSAPIs"></a>Outras aplicações que suportam as APIs de RMS: Instalação e configuração
Esta categoria inclui aplicações de linha de negócio que são escritas in-house utilizando o SDK RMS e aplicações a partir de fornecedores de software que são escritos utilizando o SDK RMS. Para estas aplicações, siga as instruções fornecidas com a aplicação.

## Próximos passos
Após ter configurado as aplicações para suportar a gestão de direitos do Azure, utilize o [Plano de implementação do Azure Rights Management](../Topic/Azure_Rights_Management_Deployment_Roadmap.md) para verificar se existem outros passos de configuração que pode querer fazer antes de ser realizadas [!INCLUDE[aad_rightsmanagement_1](../Token/aad_rightsmanagement_1_md.md)] para utilizadores e administradores. Se não estiver, consulte o artigo [Utilizar o Azure Rights Management](../Topic/Using_Azure_Rights_Management.md) para os próximos passos.

## Consultar Também
[Configurar a gestão de direitos do Azure](../Topic/Configuring_Azure_Rights_Management.md)

